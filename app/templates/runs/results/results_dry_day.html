<!DOCTYPE html>
<html lang="en">
  {% include 'head.html' %}

  <body class="bg-gray-50 dark:bg-slate-900">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
    <!-- ========== HEADER ========== -->
    {% include 'header.html' %} {% include 'sidebar.html' %}

    <!-- Content -->
    <div class="max-w-[90rem] px-4 py-4 sm:px-6 lg:px-8 lg:ps-64 mx-auto">
      <!-- Table Section -->
      <div class="max-w-[85rem] px-4 sm:px-6 lg:px-8 lg:py-14 mx-auto">
        <!-- Card -->
        <div class="flex flex-col">
          <div class="-m-1.5 overflow-x-auto">
            <div class="p-1.5 min-w-full inline-block align-middle">
              <div
                class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden dark:bg-slate-900 dark:border-gray-700"
              >
                <!-- Header -->
                <div
                  class="px-6 py-4 flex justify-between items-center border-b border-gray-200 dark:border-gray-700"
                >
                  <div>
                    <h2
                      class="text-xl font-semibold text-gray-800 dark:text-gray-200"
                    >
                      {{ location.name }} - {{ run.name }} - Dry Day Discharges
                    </h2>
                    <br />
                    <p
                      class="text-sm text-gray-600 dark:text-gray-400 font-medium"
                    >
                      Yearly Dry Day Percentage
                    </p>
                  </div>
                  <div>
                    <div class="inline-flex gap-x-2">
                      <a
                        href="/{{ location.id }}/{{ run.id }}"
                        class="py-2 px-3 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="1.5"
                          stroke="currentColor"
                          class="flex-shrink-0 size-4"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M15.75 19.5 8.25 12l7.5-7.5"
                          />
                        </svg>
                        Back
                      </a>

                      <a
                      href="/download/dry_day/{{ location.id }}/{{ run.id }}"
                      class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"
                      >
                        <svg
                          class="flex-shrink-0 size-3"
                          xmlns="http://www.w3.org/2000/svg"
                          width="16"
                          height="16"
                          viewBox="0 0 16 16"
                          fill="none"
                        >
                          <path
                            d="M2.63452 7.50001L13.6345 7.5M8.13452 13V2"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                          />
                        </svg>
                        Export
                      </a>
                    </div>
                  </div>
                </div>
                <!-- End Header -->
                <!-- Table -->
                <table
                  class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
                >
                  <!-- Table Heading -->
                  <thead class="bg-gray-50 dark:bg-slate-800">
                    <tr>
                      <th
                        scope="col"
                        class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200"
                      >
                        Year
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-800 dark:text-gray-200"
                      >
                        Percentage
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    class="bg-white dark:bg-slate-900 divide-y divide-gray-200 dark:divide-gray-700"
                  >
                    {% for result in dry_day_results %}
                    <tr class="hover:bg-gray-200 dark:hover:bg-slate-800">
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"
                      >
                        {{ result.year }}
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"
                      >
                        {% if result.dryPerc > 0 %} {{ '%.*g' | format(3,
                        result.dryPerc)}} {% else %} {{result.dryPerc}} {% endif
                        %}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <!-- End Table -->
              </div>
            </div>
          </div>
        </div>
        <!-- End Card -->
      </div>
    </div>
    <!-- End Table Section -->

    <!-- Chart Section -->
    <div class="max-w-[87.4rem] px-4 py-4 sm:px-6 lg:px-8 lg:ps-64 mx-auto">
      <!-- Card -->
      <div class="flex flex-col">
        <div class="p-1.5 min-w-full inline-block align-middle">
          <div
            class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden dark:bg-slate-900 dark:border-gray-700"
          >
            <!-- Header -->
            <div
              class="px-6 py-4 flex justify-between items-center border-b border-gray-200 dark:border-gray-700"
            >
              <div>
                <h2
                  class="text-xl font-semibold text-gray-800 dark:text-gray-200"
                >
                  Dry Day Percentage Chart
                </h2>
              </div>
              <div>
                <button
                  id="toggleMode"
                  class="py-2 px-3 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"
                >
                  <span id="modeText">Light Mode</span>
                </button>
              </div>
            </div>
            <!-- End Header -->
            <!-- Chart -->
            <div class="p-6 max-w-[87.4rem] mx-auto dark">
              <canvas id="dryDayChart" width="400" height="200"></canvas>
            </div>
            <!-- End Chart -->
          </div>
        </div>
      </div>
    </div>
    <!-- End Card -->
  </body>
</html>

<script>
  var ctx = document.getElementById('dryDayChart').getContext('2d');
  var minValue = Math.min(...[
    {% for result in dry_day_results %}
    {{ '%.*g' | format(3, result.dryPerc) }},
    {% endfor %}
  ]) - 5;
  var maxValue = Math.max(...[
    {% for result in dry_day_results %}
    {{ '%.*g' | format(3, result.dryPerc) }},
    {% endfor %}
  ]);

  maxValue = Math.ceil(maxValue);
  minValue = Math.floor(minValue);
  var isDarkMode = ctx.canvas.parentNode.classList.contains('dark');
  var myChart;

  function toggleMode() {
    var body = document.body;
    body.classList.toggle('dark');
    isDarkMode = !isDarkMode;
    updateChart();
    updateModeText();
  }

  function updateChart() {
    if (myChart) {
      myChart.options.scales.y.ticks.color = isDarkMode ? '#ffffff' : '#333333';
      myChart.options.scales.y.grid.color = isDarkMode ? '#2d333a' : '#e5e7eb';
      myChart.options.scales.x.ticks.color = isDarkMode ? '#ffffff' : '#333333';
      myChart.options.scales.x.grid.color = isDarkMode ? '#2d333a' : '#e5e7eb';
      myChart.options.plugins.legend.labels.color = isDarkMode ? '#ffffff' : '#333333';
      myChart.canvas.parentNode.style.backgroundColor = isDarkMode ? '#1e293b' : '#f9fafb';
      myChart.update();
    }
  }

  function updateModeText() {
    var modeText = document.getElementById('modeText');
    modeText.textContent = isDarkMode ? 'Light Mode' : 'Dark Mode';
  }

  function createChart() {
    myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [
          {% for result in dry_day_results %}
          "{{ result.year }}",
          {% endfor %}
        ],
        datasets: [{
          label: 'Dry Day Percentage',
          data: [
            {% for result in dry_day_results %}
            {{ '%.*g' | format(3, result.dryPerc) }},
            {% endfor %}
          ],
          fill: false,
          borderColor: 'rgb(75, 192, 192)',
          tension: 0.1
        }]
      },
      options: {
        scales: {
          y: {
            min: minValue + 3,
            max: maxValue + 2,
            ticks: {
              color: isDarkMode ? '#ffffff' : '#333333',
              stepSize: 2
            },
            grid: {
              color: isDarkMode ? '#2d333a' : '#e5e7eb'
            }
          },
          x: {
            ticks: {
              color: isDarkMode ? '#ffffff' : '#333333',
              autoSkip: false,
              maxRotation: 0,
              minRotation: 0
            },
            grid: {
              color: isDarkMode ? '#2d333a' : '#e5e7eb'
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: isDarkMode ? '#ffffff' : '#333333'
            }
          }
        }
      }
    });

    ctx.canvas.parentNode.style.backgroundColor = isDarkMode ? '#1e293b' : '#f9fafb';
  }

  var toggleButton = document.getElementById('toggleMode');
  toggleButton.addEventListener('click', toggleMode);

  createChart();
  updateModeText();
</script>
